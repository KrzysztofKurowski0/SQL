@PAR ?@D17|DataOd|&DataOd:REG={Today()} @? PAR@
@PAR ?@D17|DataDo|&DataDo:REG={Today()} @? PAR@
@PAR ?@O(Grupa:2|Ilosc:3||Wartosc:4|Marza:5)|Sortowanie|Sortowanie:REG=1 @? PAR@

select

id = 1

,CDN.TwrGrupaPelnaNazwa(Twg_GRONumer) as Grupa

,convert(int, isnull(sum(TrS_Ilosc),0)) as [Iloœæ]
,isnull(convert(decimal(15,2), (sum(convert(decimal(15,4), TrE_KsiegowaNetto*convert(decimal(15,4), TrS_Ilosc/convert(decimal(15,4), TrE_Ilosc)))))),0) as [Wartoœæ]
,isnull(convert(decimal(15,2), (sum(convert(decimal(15,4), TrE_KsiegowaNetto*convert(decimal(15,4), TrS_Ilosc/convert(decimal(15,4), TrE_Ilosc))))-sum(convert(decimal(15,4), TrE_KosztKsiegowy*convert(decimal(15,4), TrS_Ilosc/convert(decimal(15,4), TrE_Ilosc)))))),0) as [Mar¿a]

from CDN.TraNag WITH (NOLOCK)
join CDN.TraSElem WITH (NOLOCK) on TrN_GIDTyp=TrS_GIDTyp AND TrN_GIDNumer=TrS_GIDNumer
join CDN.TraElem WITH (NOLOCK) on TrE_GIDTyp=TrS_GIDTyp AND TrE_GIDNumer=TrS_GIDNumer AND TrE_GIDLp=TrS_GIDLp
join CDN.TwrKarty WITH (NOLOCK) on Twr_GIDNumer=TrE_TwrNumer
join cdn.twrgrupy WITH (NOLOCK) on Twr_GIDTyp=TwG_GIDTyp AND Twr_GIDNumer=TwG_GIDNumer and TwG_GIDTyp=16

where trn_gidtyp in (2033, 2034, 2041, 2042, 2001, 2009, 2037, 2045, 2005, 2013)

and trn_data2 between ??DataOd and ??DataDo and TrS_Ilosc <> 0

and TwG_GrONumer in (197523,194850,194209,19184,205289,218174,212403,197054,19202,194080,19207,194077,19205,195053,210921,210916,19214,
194616,19192,19185,194945,194513,19189,199966,194785,68945,194079,194489,19186,198364,194514,194225,194607,195408,59844,19215,194265,202684,210914,194042,
194566,202685,19206,23140,195652,19217,198099,194081,214513,194199,194914,23836,217282,28456,198401,194278,19204,23138,196963,194072,195084,195127,19203,
194196,195096,149470,194263,195656,19208,19179,19191,194496,195406,196263,196378,23194,16849,194275,194269,56095,19218,217277,212651,194085,194221,212707,
194707,194463,19180,19213,19,194665,194491,194213,194394,122177,194467,200484,195702,19211,198400,194262,210911,198324,194041,23141,195848,198406,194866,
195106,198382,195075,195569,195749,194215,212684,201492,195414,194449,28455,194414,23775,19193,35,197415,198409,194465,195083,195582,212657,198105,212439,
195583,19196,194767,194040,197894,152438,194756,194069,194647,194882,212422,212659,195751,196316,212640,198200,19183,195383,194228,51,195595,140483,194292,
19210,23143,194464,194276,194068,19216,19187,194662,203560,194930,194764,194253,194171,194471,195663,195937,198201,196357,47,203967,203838,203835,196965,
139140,212712,19190,217437,19188,203836,19194,198405,198404,195704,198407,194078,194565,194416,203837,23727,19195,19209,19197,152297,19219,194924,
194203,212688,194235,194883,194230,19201,19212,203935,194493,194617,196327,212667,195870,195779,194735,195614,19198,198104,194417,19220,210917,212647,
23144,198206,194773,195566,217283,199956,199962,194894,205303,195971,198367,194035,212427,194036,217270,217278,212393,156784,195063,194087,194932)

group by CDN.TwrGrupaPelnaNazwa(Twg_GRONumer)

order by ??Sortowanie asc

